---
ë‚ ì§œ: 2025-04-01
Objective: ë…¸ë“œ ê¸°ë°˜(í™˜ê²½)ì˜ ê°„ë‹¨í•œ applicationì„ Dockerfile ì„ í†µí•´ì„œ Image í™” í•˜ê³  ê¸°ë™í•´ë³´ì
tags:
  - ğŸ²Project/ê°œë°œí™œë™/ê°œì¸ì„œë²„êµ¬ì¶•/Dockerê°•ì˜
---
OverVIew 

 - ë…¸ë“œ ê¸°ë°˜ì˜ ê°„ë‹¨í•œ Dockerfile ì‘ì„± ë° build, run

Details 
# ë…¸ë“œ ê¸°ë°˜ì˜  Dockfile 
```bash
# enviorment ==> From ì„ í†µí•´ í™˜ê²½ì¸ baseimageì¸ node ì´ë¯¸ì§€ ê·¸ ìì²´ë¥¼ ì„ ì–¸í•œë‹¤. 
# runtime enviorment ë¥¼ ì„ ì–¸í•œë‹¤ê³  ìƒê°
# From baseImage:tag
FROM node:22

#Dokcer ì»¨í…Œì´ë„ˆê°€ ì‘ì—…ë˜ëŠ” ê³µê°„ ?
WORKDIR /app

# copy the packege.json and package-lock.json
# install the dependencies
# expose the applicaion port
# start application


# copy the packege.json and package-lock.json
# í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ json íŒŒì¼ë“¤ì„ ì•„ë§ˆ dockerì»¨í…Œì´ë„ˆê°€ ë™ì‘í•˜ëŠ” /app ìœ¼ë¡œ ì˜®ê¸´ë‹¤.
COPY package*.json .

# install dependencies
# pakage*.json íŒŒì¼ì— ìˆëŠ” dependencies ë¥¼ ë‚´ë ¤ë°›ëŠ”ë‹¤ 
# npm install ì˜ right ë²„ì „
RUN npm ci

# into /app/index.js
COPY src/index.js index.js

#í•´ë‹¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ 3000ë²ˆì„ ì“°ê³  ìˆìœ¼ë‹ˆ ì—´ì–´ì¤€ë‹¤.
EXPOSE 3000

CMD [ "node", "index.js" ]
```

- workdir ì„ ì„ ì–¸ í•˜ë©´ 
  ```bash
jaebukbuk@jaebukbukubuntu24:~/containerize-express-app$ docker exec -it 67e5b501ff06 /bin/bash
root@67e5b501ff06:/app#
root@67e5b501ff06:/app# ls
index.js  node_modules  package-lock.json  package.json
root@67e5b501ff06:/app# cd ..
root@67e5b501ff06:/# ls
app  bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
```
- ë‹¤ìŒê³¼ ê°™ì´ /app ìœ¼ë¡œ root dir í•˜ìœ„ì— app dir ì‘ì—…ê³µê°„ì´ ìƒê¸´ê±¸ í™•ì¸í• ìˆ˜ ìˆë‹¤.
-

```bash
jaebukbuk@jaebukbukubuntu24:~/containerize-express-app$ docker build -t express_app:v0.0.1 .
[+] Building 22.8s (11/11) FINISHED  docker:default
 => [internal] load build definition from Dockerfile
 => => transferring dockerfile: 336B                 
 => [internal] load metadata for docker.io/library/node:22 
 => [auth] library/node:pull token for registry-1.docker.io
 => [internal] load .dockerignore
 => => transferring context: 2B 
 => [1/5] FROM docker.io/library/node:22@sha256:c7fd844945a76eeaa83cb372e4d289b4a30b478a1c80e16c685b62c54  16.4s

...
 sha256:775a325bc2aa2aa75e855af154839b397d850e14c927204905e3f46f718ffb58                   0.0s
 => [internal] load build context
 => => transferring context: 28.34kB
 => [2/5] WORKDIR /app 
 => [3/5] COPY package*.json . 
 => [4/5] RUN npm ci 
 => [5/5] COPY src/index.js index.js 
 => exporting to image
 => => exporting layers
 => => writing image sha256:75ad6404292d1b3dd55e3e835745996b84d0238227add5209878b55fdde086c9 
 => => naming to docker.io/library/express_app:v0.0.1
```
- Dockerfile ëª…ë ¹ëŒ€ë¡œ ì´ë¯¸ì§€ê°€ ìƒì„±ëœê±¸ í™•ì¸í• ìˆ˜ ìˆë‹¤.
```bash
jaebukbuk@jaebukbukubuntu24:~/containerize-express-app$ docker images                                            
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
express_app   v0.0.1    75ad6404292d   6 seconds ago   1.13GB
```

- ì´ì œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  í…ŒìŠ¤íŠ¸ í•´ë³´ë©´ ê¸°ì¡´ê³¼ ê°™ì´ ì˜ ì‘ë™í•¨ì„ ì•Œìˆ˜ ìˆë‹¤.

# docker pause 
- docker ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ì¤‘ì¼ë•Œ
```bash
aebukbuk@jaebukbukubuntu24:~/containerize-express-app$ docker start express_app
express_app

jaebukbuk@jaebukbukubuntu24:~$ curl http://localhost:3000
Hello world!
```
- ì‘ë‹µì´ ì˜ì˜¨ë‹¤.

- docker ì»¨í…Œì´ë„ˆê°€ stop ì¢…ë£Œì¤‘ì¼ë–„
```bash
~/containerize-express-app$ docker stop express_app
express_app

~$ curl http://localhost:3000
curl: (7) Failed to connect to localhost port 3000 after 0 ms: Couldn't connect to server
```
- ë‹¹ì—°íˆ ì‹¤íŒ¨í•œë‹¤.
- => ë‹¹ì—°í•˜ì§€ë§Œ docker container ê°€ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ë©”ëª¨ë¦¬ëŠ” ì´ˆê¸°í™” ë˜ë¯€ë¡œ ì¬ì‹¤í–‰ start í–ˆì„ë•Œ ì‚¬ìš©í–ˆë˜ ë©”ëª¨ë¦¬ ì»¨í…Œì¸ ëŠ” ì´ˆê¸°í™”ëœë‹¤.

- docker ê°€ ì¼ì‹œì¤‘ì§€ ì¼ë•ŒëŠ”!? 
```bash
~/containerize-express-app$ docker pause express_app
express_app

~/containerize-express-app$ docker ps
CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS                   PORTS                                       NAMES
9e51cf5407bd   express_app:v0.0.1   "docker-entrypoint.sâ€¦"   7 minutes ago   Up 14 seconds (Paused)   0.0.0.0:3000->3000/tcp, :::3000->3000/tcp   express_app

jaebukbuk@jaebukbukubuntu24:~$ curl http://localhost:3000


^C
jaebukbuk@jaebukbukubuntu24:~$ curl -d '{"userId":"jaebukbuk"}' -H "Content-Type: application/json" -X POST localhost:3000/users
^C
```
- ì •ìƒì ì¸ ìš”ì²­ì²˜ë¦¬ê°€ ì•ˆëœë‹¤. 

- ë‹¤ì‹œ unpose ë¡œ ì‹¤í–‰ì‹œí‚¤ë©´
```bash
~/containerize-express-app$ docker unpause express_app
express_app

~$ curl http://localhost:3000
Hello world!
```
- ì˜ ë™ì‘í•œë‹¤.


# ë„ì»¤ ì´ë¯¸ì§€ ì‚­ì œì‹œ ì˜¤ë¥˜ì¡ê¸°

- ì˜¤ë¥˜ ìƒí™©! - ë„ì»¤ ì´ë¯¸ì§€ ì‚­ì œê°€ ì•ˆëœë‹¤!
```bash
~/containerize-express-app$ docker rmi express_app:v0.0.1
Error response from daemon: conflict: unable to remove repository reference "express_app:v0.0.1" (must force) - container 9e51cf5407bd is using its referenced image 75ad6404292d
```
- ì´ëŠ” í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì°¸ì¡°í•˜ëŠ” ì»¨í…Œì´ë„ˆê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì´ë‹¤
  => ì»¨í…Œì´ë„ˆë¥¼ ë¨¼ì € ì§€ìš°ê³  ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ë¼

``` bash
/containerize-express-app$ docker rm express_app
express_app
/containerize-express-app$ docker rmi express_app:v0.0.1
Untagged: express_app:v0.0.1
Deleted: sha256:75ad6404292d1b3dd55e3e835745996b84d0238227add5209878b55fdde086c9
```