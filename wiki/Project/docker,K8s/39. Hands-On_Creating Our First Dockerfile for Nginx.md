---
날짜: 2025-03-25
tags:
  - 🐲Project/개발활동/개인서버구축/Docker강의
---
# [648838](https://mail.naver.com/v2/read/-1/15222)OverVIew

- dockerfile 간단 예시
- dockerfile 의 cash 확인


Details
# Dockerfile 간단 예시
```bash
FROM nginx:1.27.0

RUN apt-get update
RUN apt-get install vim
```
- docker build -t web_server  . 
```bash
+] Building 10.7s (7/7) FINISHED   docker:default
 => [internal] load build definition from Dockerfile              0.0s
 => => transferring dockerfile: 99B                               0.0s
 => [internal] load metadata for docker.io/library/nginx:1.27.0   2.6s
 => [auth] library/nginx:pull token for registry-1.docker.io             
 => [internal] load .dockerignore                                          ...
 => [2/3] RUN apt-get update                                      2.8s
 => ERROR [3/3] RUN apt-get install vim                           1.4s 
------                                                                                                                          
 > [3/3] RUN apt-get install vim:                                                                                               
0.230 Reading package lists...
0.848 Building dependency tree...                     
0.994 Reading state information...                                        
1.221 The following additional packages will be installed:                
1.222   libgpm2 libsodium23 vim-common vim-runtime xxd
1.224 Suggested packages:
1.224   gpm ctags vim-doc vim-scripts
1.336 The following NEW packages will be installed:
1.337   libgpm2 libsodium23 vim vim-common vim-runtime xxd
1.349 0 upgraded, 6 newly installed, 0 to remove and 27 not upgraded.
1.349 Need to get 8979 kB of archives.
1.349 After this operation, 41.9 MB of additional disk space will be used.
1.349 Do you want to continue? [Y/n] Abort.
------
Dockerfile:4
--------------------
   2 |     
   3 |     RUN apt-get update
   4 | >>> RUN apt-get install vim
   5 |     
--------------------
ERROR: failed to solve: process "/bin/sh -c apt-get install vim" did not complete successfully: exit code: 1
```
- Dockerfile instruction 설정이 잘못되어 오류
```bash
FROM nginx:1.27.0

RUN apt-get update
RUN apt-get -y install vim
```
- 적절한 instruction arg 선언
```bash
[+] Building 4.5s (7/7) FINISHED  docker:default
 => [internal] load build definition from Dockerfile                 0.0s
 => => transferring dockerfile: 102B                                 0.0s
 => [internal] load metadata for docker.io/library/nginx:1.27.0      0.7s
 => [internal] load .dockerignore                                    0.0s
 => => transferring context: 2B                                      0.0s
 => [1/3] FROM docker.io/library/nginx:1.27.0@sha256:98f8ec75657d21b924fe4f69b6b9bff2f6550ea48838af479d8894a852000e40                     0.0s
 => CACHED [2/3] RUN apt-get update              0.0s
 => [3/3] RUN apt-get -y install vim             3.4s
 => exporting to image                           0.3s 
 => => exporting layers                          0.2s 
 => => writing image sha256:0c871d883733efad77bc857b77f2a00cd8e6f57288a9408f5f3e9b1b47bc4dd8                                                    0.0s 
 => => naming to docker.io/library/web_server                                                                              0.0s 
```
-  적절한 인자를 통해 잘 동작한걸 확인 할수 있다.

```bash
jaebukbuk@jaebukbukubuntu24:~$ docker exec -it c8720455ef61 sh
# vim
# exit
```
- 도커파일을 통해 vim 도 설치했으므로 해당 컨테이너에서 vim 을 실행할수있다.
- (아마 전 예제에서 설치 안하고 들어왔을때는 OS 에서 vim 이 있어도 해당 컨테이너 에서 실행 못시켯던거 기억나 -> 확인 필요)

# Dockerfile with cash
```bash
ocker build -t web_server_2  . 
[+] Building 1.4s (8/8) FINISHED           docker:default
 => [internal] load build definition from Dockerfile             0.0s
 => => transferring dockerfile: 102B                             0.0s
 => [internal] load metadata for docker.io/library/nginx:1.27.0  1.3s
 => [auth] library/nginx:pull token for registry-1.docker.io     0.0s
 => [internal] load .dockerignore                                0.0s
 => => transferring context: 2B                                  0.0s
 => [1/3] FROM docker.io/library/nginx:1.27.0@sha256:98f8ec75657d21b924fe4f69b6b9bff2f6550ea48838af479d8894a852000e40                     0.0s
 
 => CACHED [2/3] RUN apt-get update              0.0s
 => CACHED [3/3] RUN apt-get -y install vim      0.0s
 => exporting to image                           0.0s
 => => exporting layers                          0.0s
 => => writing image sha256:0c871d883733efad77bc857b77f2a00cd8e6f57288a9408f5f3e9b1b47bc4dd8                                                    0.0s
 => => naming to docker.io/library/web_server_2  0.0s
```
- 여기서 보면 도커파일의 인스트럭션이 실행될떄 cashed 된것을 볼수 있다.
- 좀더 파악 해야겠지만, 같은 각 insruction들은 각각의 이미지를 가지기 떄문에 
  베이스 이미지로 부터 같은 인스트럭션이 동작해서 같은 이미지를 실행한 것이므로 
  케쉬를 탄거다.
- 